(function(){"use strict";var t={771:function(t,e,a){var r=a(5130),s=a(6768),o=a(4232);const n=(0,s.Lk)("header",{class:"fixed-title"},"学生课堂情感分析",-1),i={id:"user"},d={key:0,id:"status"},u={id:"app"};function l(t,e,a,r,l,c){const p=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)(s.FK,null,[n,(0,s.Lk)("header",i,[t.isLoggedIn?((0,s.uX)(),(0,s.CE)("label",d,"你好，"+(0,o.v_)(t.$store.state.user.username),1)):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:e[0]||(e[0]=(...t)=>c.loginout&&c.loginout(...t)),style:(0,o.Tr)({backgroundColor:t.isLoggedIn?"red":"#007bff"})},(0,o.v_)(t.isLoggedIn?"退出":"登录"),5)]),(0,s.Lk)("div",u,[(0,s.bF)(p)])],64)}a(4114);var c=a(8355),p=a(782),m={name:"App",computed:{...(0,p.L8)(["isLoggedIn"])},methods:{async loginout(){if(this.isLoggedIn){this.$store.dispatch("logout");await c.A.post("/api/logout/");console.log("logout"),this.$router.push("/login")}else this.$router.push("/login")}}},h=a(1241);const v=(0,h.A)(m,[["render",l]]);var f=v,g=a(1387);const L=t=>((0,s.Qi)("data-v-65fec48d"),t=t(),(0,s.jt)(),t),b={class:"login-form"},k=L((()=>(0,s.Lk)("h2",null,"登录",-1))),y={class:"form-container"},w={class:"form-group"},I=L((()=>(0,s.Lk)("label",{for:"username"},"账号:",-1))),C={class:"form-group"},$=L((()=>(0,s.Lk)("label",{for:"password"},"密码:",-1))),A={class:"form-group"},D={class:"form-group"};function x(t,e,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",b,[k,(0,s.Lk)("div",y,[(0,s.Lk)("form",{onSubmit:e[4]||(e[4]=(0,r.D$)(((...t)=>i.submitForm&&i.submitForm(...t)),["prevent"])),class:"left"},[(0,s.Lk)("div",w,[I,(0,s.bo)((0,s.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=t=>n.username=t),required:""},null,512),[[r.Jo,n.username]])]),(0,s.Lk)("div",C,[$,(0,s.bo)((0,s.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=t=>n.password=t),required:""},null,512),[[r.Jo,n.password]])]),(0,s.Lk)("div",A,[(0,s.Lk)("button",{type:"submit",id:"login",onClick:e[2]||(e[2]=(...e)=>t.login&&t.login(...e))},"登录")]),(0,s.Lk)("div",D,[(0,s.Lk)("button",{type:"submit",id:"registration",onClick:e[3]||(e[3]=e=>t.$router.push("/register"))},"注册")])],32)])])}var P={data(){return{username:"",password:""}},mounted(){this.checkLogin()},methods:{async checkLogin(){const t=await c.A.post("/api/session/");0===Object.keys(t.data).length||("student"==t.data["type"]?this.$router.push("/student"):"teacher"==t.data["type"]&&this.$router.push("/teacher"),this.$store.dispatch("login",{username:t.data["username"]}))},async submitForm(){try{const t=await c.A.post("/api/login/",{username:this.username,password:this.password});"student"==t.data["data"]["type"]?this.$router.push("/student"):"teacher"==t.data["data"]["type"]&&this.$router.push("/teacher"),this.$store.dispatch("login",{username:this.username})}catch(t){}}}};const _=(0,h.A)(P,[["render",x],["__scopeId","data-v-65fec48d"]]);var j=_,F=a.p+"img/avatar.afc6f7b7.png";const O=t=>((0,s.Qi)("data-v-10d82ee1"),t=t(),(0,s.jt)(),t),U={class:"registration-form"},E=O((()=>(0,s.Lk)("h2",null,"注册",-1))),M={class:"form-container"},q={class:"form-group"},V=O((()=>(0,s.Lk)("label",{for:"name"},"姓名:",-1))),S={class:"form-group"},J=O((()=>(0,s.Lk)("label",{for:"username"},"账号:",-1))),X={class:"form-group"},R=O((()=>(0,s.Lk)("label",{for:"password"},"密码:",-1))),T={class:"form-group"},Q=O((()=>(0,s.Lk)("label",{for:"confirm-password"},"确认密码:",-1))),B={class:"form-group"},z=O((()=>(0,s.Lk)("label",{for:"teachercode"},"教师验证码:",-1))),K=O((()=>(0,s.Lk)("div",{class:"form-group"},[(0,s.Lk)("button",{type:"submit"},"注册")],-1))),G={class:"form-group"},H=O((()=>(0,s.Lk)("label",{for:"avatar"},"上传头像:",-1))),N={key:0,class:"avatar-preview"},W=["src"],Y={key:1,class:"avatar-placeholder"},Z=O((()=>(0,s.Lk)("img",{src:F,alt:"Avatar Placeholder"},null,-1))),tt=[Z];function et(t,e,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",U,[E,(0,s.Lk)("div",M,[(0,s.Lk)("form",{onSubmit:e[5]||(e[5]=(0,r.D$)(((...t)=>i.submitForm&&i.submitForm(...t)),["prevent"])),class:"left"},[(0,s.Lk)("div",q,[V,(0,s.bo)((0,s.Lk)("input",{type:"text",id:"name","onUpdate:modelValue":e[0]||(e[0]=t=>n.name=t),required:""},null,512),[[r.Jo,n.name]])]),(0,s.Lk)("div",S,[J,(0,s.bo)((0,s.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":e[1]||(e[1]=t=>n.username=t),required:""},null,512),[[r.Jo,n.username]])]),(0,s.Lk)("div",X,[R,(0,s.bo)((0,s.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":e[2]||(e[2]=t=>n.password=t),required:""},null,512),[[r.Jo,n.password]])]),(0,s.Lk)("div",T,[Q,(0,s.bo)((0,s.Lk)("input",{type:"password",id:"confirm-password","onUpdate:modelValue":e[3]||(e[3]=t=>n.confirmPassword=t),required:""},null,512),[[r.Jo,n.confirmPassword]])]),(0,s.Lk)("div",B,[z,(0,s.bo)((0,s.Lk)("input",{type:"text",id:"teachercode","onUpdate:modelValue":e[4]||(e[4]=t=>n.teachercode=t),required:""},null,512),[[r.Jo,n.teachercode]])]),K],32),(0,s.Lk)("form",{onSubmit:e[7]||(e[7]=(0,r.D$)(((...t)=>i.submitForm&&i.submitForm(...t)),["prevent"])),class:"right"},[(0,s.Lk)("div",G,[H,(0,s.Lk)("input",{type:"file",id:"avatar",accept:"image/*",onChange:e[6]||(e[6]=(...t)=>i.handleAvatarChange&&i.handleAvatarChange(...t))},null,32),n.avatarPreview?((0,s.uX)(),(0,s.CE)("div",N,[(0,s.Lk)("img",{src:n.avatarPreview,alt:"Avatar Preview"},null,8,W)])):((0,s.uX)(),(0,s.CE)("div",Y,tt))])],32)])])}a(4603),a(7566),a(8721);var at={data(){return{name:"",username:"",password:"",confirmPassword:"",teachercode:"",avatar:null,avatarPreview:null}},methods:{async submitForm(){try{if(this.password==this.confirmPassword){const t=new FormData;t.append("name",this.name),t.append("username",this.username),t.append("password",this.password),t.append("teachercode",this.teachercode),t.append("avatar",this.avatar);await c.A.post("/api/register/",t,{headers:{"Content-Type":"multipart/form-data"}});this.$router.push("/login")}}catch(t){}},handleAvatarChange(t){const e=t.target.files[0];if(e){const t=new FileReader;t.onload=()=>{const e=t.result.split(",")[1];this.avatar=e},t.readAsDataURL(e),this.avatarPreview=URL.createObjectURL(e)}else this.avatar=null,this.avatarPreview=null}}};const rt=(0,h.A)(at,[["render",et],["__scopeId","data-v-10d82ee1"]]);var st=rt;const ot=t=>((0,s.Qi)("data-v-09b3fb01"),t=t(),(0,s.jt)(),t),nt={class:"student-form"},it=ot((()=>(0,s.Lk)("h2",null,"实时",-1))),dt=ot((()=>(0,s.Lk)("div",{class:"form-container"},[(0,s.Lk)("div",{class:"layout",id:"center"},[(0,s.Lk)("label",{for:"status",id:"statusLabel"},"您当前的状态未检测")])],-1))),ut=[it,dt];function lt(t,e,a,r,o,n){return(0,s.uX)(),(0,s.CE)("div",nt,ut)}var ct={computed:{...(0,p.L8)(["isLoggedIn"])},mounted(){this.statusDetect()},methods:{async statusDetect(){await this.stopDetect(),this.statusInterval=setInterval((async()=>{try{if(this.isLoggedIn){const e=await c.A.post("/api/status/");var t=document.getElementById("statusLabel");""==e.data["emotion"]?t.textContent="您当前的状态未检测":t.textContent="您当前的状态是："+e.data["emotion"]}else await this.stopDetect()}catch(e){await this.stopDetect()}}),1e3)},stopDetect(){this.statusInterval&&window.clearInterval(this.statusInterval)}}};const pt=(0,h.A)(ct,[["render",lt],["__scopeId","data-v-09b3fb01"]]);var mt=pt;const ht=t=>((0,s.Qi)("data-v-7195ef30"),t=t(),(0,s.jt)(),t),vt={class:"teacher-form"},ft=ht((()=>(0,s.Lk)("h2",null,"实时",-1))),gt={class:"form-container"},Lt=ht((()=>(0,s.Lk)("div",{id:"center"},[(0,s.Lk)("div",{class:"layout",id:"left"},[(0,s.Lk)("img",{id:"video-img",alt:"Video Placeholder"})]),(0,s.Lk)("div",{class:"layout",id:"right"},[(0,s.Lk)("svg",{id:"pie-chart",alt:"Visual Placeholder"})])],-1))),bt={class:"layout",id:"bottom"},kt=ht((()=>(0,s.Lk)("label",{for:"addr"},"推流地址",-1))),yt=ht((()=>(0,s.Lk)("button",{type:"submit"},"连接",-1)));function wt(t,e,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",vt,[ft,(0,s.Lk)("div",gt,[Lt,(0,s.Lk)("form",{onSubmit:e[1]||(e[1]=(0,r.D$)(((...t)=>i.submitForm&&i.submitForm(...t)),["prevent"]))},[(0,s.Lk)("div",bt,[kt,(0,s.bo)((0,s.Lk)("input",{type:"text",id:"videoaddr","onUpdate:modelValue":e[0]||(e[0]=e=>t.videoaddr=e),required:""},null,512),[[r.Jo,t.videoaddr]]),yt])],32)])])}var It={data(){return{addr:""}},computed:{...(0,p.L8)(["isLoggedIn"])},methods:{async submitForm(){await this.stopDetect();const t=document.getElementById("video-img");t.src="",console.log("reset");await c.A.post("/api/detect/",{videoaddr:this.videoaddr});this.videoDetect(),this.staticDetect()},async videoDetect(){this.videoInterval=setInterval((async()=>{try{if(this.isLoggedIn){const t=await c.A.post("/api/detect/"),e=document.getElementById("video-img");e.src="data:image/jpeg;base64,"+t.data["data"]["videoframe"]}else await this.stopDetect()}catch(t){await this.stopDetect()}}),30)},async staticDetect(){this.staticInterval=setInterval((async()=>{try{if(this.isLoggedIn){const t=await c.A.post("/api/detect/");this.refreshPieChart(t.data["data"]["emotions"])}else await this.stopDetect()}catch(t){await this.stopDetect()}}),1e3)},stopDetect(){this.videoInterval&&window.clearInterval(this.videoInterval),this.staticInterval&&window.clearInterval(this.staticInterval)},refreshPieChart(t){const e=t.reduce(((t,e)=>(t[e]=(t[e]||0)+1,t)),{}),a=Object.entries(e).map((([t,e])=>({label:t,value:e}))),r=500,s=500,o=Math.min(r,s)/2,n=d3.select("#pie-chart").attr("width",r).attr("height",s).append("g").attr("transform",`translate(${r/2},${s/2})`),i=d3.pie().value((t=>t.value)),d=d3.arc().innerRadius(0).outerRadius(o),u=n.selectAll("arc").data(i(a)).enter().append("g").attr("class","arc");u.append("path").attr("d",d).attr("fill",((t,e)=>d3.schemeCategory10[e])),u.append("text").attr("text-anchor","middle").attr("transform",(t=>{const[e,a]=d.centroid(t),r=Math.atan2(a,e),s=Math.sqrt(e*e+a*a)/4,o=Math.cos(r)*s,n=Math.sin(r)*s;return`translate(${e+o},${a+n})`})).style("font-size","15pt").text((t=>t.data.label)),u.append("text").attr("text-anchor","middle").attr("transform",(t=>{const[e,a]=d.centroid(t),r=Math.atan2(a,e),s=Math.sqrt(e*e+a*a)/4,o=Math.cos(r)*s,n=Math.sin(r)*s;return`translate(${e+o},${a+n})`})).attr("dy","25pt").style("font-size","15pt").text((t=>t.data.value))}}};const Ct=(0,h.A)(It,[["render",wt],["__scopeId","data-v-7195ef30"]]);var $t=Ct;const At=(0,g.aE)({history:(0,g.LA)(),routes:[{path:"/",redirect:"/login"},{path:"/login",component:j},{path:"/register",component:st},{path:"/student",component:mt},{path:"/teacher",component:$t}]});var Dt=At,xt=(0,p.y$)({state:{user:null},mutations:{setUser(t,e){t.user=e},clearUser(t){t.user=null}},actions:{login({commit:t},e){t("setUser",e)},logout({commit:t}){t("clearUser")}},getters:{isLoggedIn:t=>!!t.user}});const Pt=(0,r.Ef)(f);Pt.use(Dt),Pt.use(xt),Pt.mount("#app")}},e={};function a(r){var s=e[r];if(void 0!==s)return s.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,a),o.exports}a.m=t,function(){var t=[];a.O=function(e,r,s,o){if(!r){var n=1/0;for(l=0;l<t.length;l++){r=t[l][0],s=t[l][1],o=t[l][2];for(var i=!0,d=0;d<r.length;d++)(!1&o||n>=o)&&Object.keys(a.O).every((function(t){return a.O[t](r[d])}))?r.splice(d--,1):(i=!1,o<n&&(n=o));if(i){t.splice(l--,1);var u=s();void 0!==u&&(e=u)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[r,s,o]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.p="/static/"}(),function(){var t={524:0};a.O.j=function(e){return 0===t[e]};var e=function(e,r){var s,o,n=r[0],i=r[1],d=r[2],u=0;if(n.some((function(e){return 0!==t[e]}))){for(s in i)a.o(i,s)&&(a.m[s]=i[s]);if(d)var l=d(a)}for(e&&e(r);u<n.length;u++)o=n[u],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return a.O(l)},r=self["webpackChunkstudent_emotion_analysis"]=self["webpackChunkstudent_emotion_analysis"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=a.O(void 0,[504],(function(){return a(771)}));r=a.O(r)})();
//# sourceMappingURL=app.9fc8267c.js.map